---
  <#list plays as play>
# Play for component ${play.name}
# add hosts
- hosts: localhost
  vars:
  tasks:
    - include_vars:
        file: ${play.name}.json
        name: requiredProperties
    - name: Add host to group 'just_created'
      add_host:
        name: ${play.hosts}
        ansible_host: '{{requiredProperties.host.address}}'
        ansible_user: ubuntu
        ansible_ssh_private_key_file: /home/diezfx/.ssh/id_rsa
        ansible_python_interpreter: /usr/bin/python3
        groups: just_created

- name: ${play.name}
  <#if play.hosts??>
  hosts: ${play.hosts}
  <#else>
  </#if>
  become: yes
  become_user: root
  <#if play.vars?? && play.vars?size != 0>
  vars:
    <#list play.vars?keys as key>
    ${key}: ${play.vars[key]}
    </#list>
  <#else>
  </#if>
  tasks:
      <#list play.files as file>
        - name: Make sure destination dir exists
          file:
            path: ${file.target} | dirname
            state: directory
        - name: Copy file to remote
          copy:
            src: ${file.src}
            dest: ${file.target}
        </#list>
        <#list play.tasks as task>
        - name: ${task.name}
          script: ${task.script}
          <#if task.args?? && task.args?size != 0>
          args:
          <#list task.args as arg>
          ${arg.name}: ${arg.value}
          </#list>
          <#else>
          </#if>
        </#list>

  </#list>